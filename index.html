<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zen Focus v5</title>
    <link rel="manifest" href="ma<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ready | Zen Focus</title>
    <link rel="manifest" href="manifest.json">
    <style>
        :root {
            --bg: #0f0f12; --surf: #1d1b20; --prim: #d0bcfe;
            --on-prim: #381e72; --sec: #4a4458; --tert: #efb8c8;
        }
        body {
            background-color: var(--bg); color: #e6e1e5;
            font-family: 'Segoe UI', system-ui, sans-serif;
            margin: 0; display: flex; flex-direction: column;
            align-items: center; justify-content: center; min-height: 100vh;
            overflow: hidden; user-select: none; /* Prevents accidental text selection */
        }
        .timer-wrapper {
            position: relative; width: 340px; height: 340px;
            display: flex; align-items: center; justify-content: center;
        }
        svg { transform: rotate(-90deg); position: absolute; }
        circle { fill: none; stroke-width: 8; stroke-linecap: round; }
        .bg-circle { stroke: #25232a; }
        .progress-circle {
            stroke: var(--prim); stroke-dasharray: 880;
            stroke-dashoffset: 0; transition: stroke-dashoffset 0.5s linear;
        }
        .timer-content { text-align: center; z-index: 1; }
        .timer-text { font-size: 6.5rem; font-weight: 200; margin: 0; tabular-nums; cursor: pointer; }
        .status-badge { font-size: 0.8rem; letter-spacing: 2px; color: var(--prim); font-weight: 600; margin-bottom: 2px;}
        .session-counter { font-size: 0.85rem; color: var(--prim); opacity: 0.8; margin-bottom: 5px; }
        .goal-inside { font-size: 0.9rem; color: #938f99; margin-top: 5px; }

        .controls { display: flex; gap: 12px; margin-top: 30px; align-items: center; }
        button { border: none; cursor: pointer; border-radius: 100px; transition: 0.2s; font-weight: bold;}
        .btn-play { background: var(--prim); color: var(--on-prim); padding: 18px 55px; font-size: 1.1rem; }
        .btn-nav { background: var(--sec); color: white; width: 55px; height: 55px; font-size: 1.2rem; }
        .btn-lunch { background: var(--tert); color: #492532; padding: 18px 25px; margin-top: 15px; }
        
        button:hover { filter: brightness(1.2); transform: scale(1.05); }
        button:active { transform: scale(0.95); }

        #settingsOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); display: none;
            justify-content: center; align-items: center; z-index: 100;
            backdrop-filter: blur(10px);
        }
        .settings-card { background: var(--surf); padding: 30px; border-radius: 28px; width: 320px; }
        .field { margin-bottom: 20px; text-align: left; }
        label { display: block; font-size: 0.8rem; color: #938f99; margin-bottom: 5px; }
        input { width: 100%; background: #2b2930; border: 1px solid #444; color: white; padding: 12px; border-radius: 10px; box-sizing: border-box; }
        .close-btn { background: var(--prim); color: var(--on-prim); width: 100%; padding: 15px; margin-top: 10px; }
        .reset-btn { background: transparent; color: #ffb4ab; width: 100%; padding: 10px; margin-top: 15px; border: 1px solid #444; }
    </style>
</head>
<body>

    <div class="timer-wrapper">
        <svg width="300" height="300"><circle class="bg-circle" cx="150" cy="150" r="140"></circle><circle id="progCircle" class="progress-circle" cx="150" cy="150" r="140"></circle></svg>
        <div class="timer-content">
            <div id="sessionDisplay" class="session-counter">Session 1 of 12</div>
            <div id="status" class="status-badge">READY</div>
            <h1 class="timer-text" id="timer" onclick="toggleTimer()">00:00</h1>
            <div class="goal-inside" id="goal-text">Goal: 0%</div>
        </div>
    </div>

    <div class="controls">
        <button class="btn-nav" onclick="openSettings()">⚙️</button>
        <button class="btn-nav" onclick="prevSession()">⏮</button>
        <button class="btn-play" id="startBtn" onclick="toggleTimer()">START</button>
        <button class="btn-nav" onclick="nextSession()">⏭</button>
    </div>
    
    <button class="btn-lunch" id="lunchBtn" onclick="toggleLunch()">TIFFIN / LUNCH</button>

    <div id="settingsOverlay">
        <div class="settings-card">
            <h2 style="margin-top:0">Settings</h2>
            <div class="field"><label>Study (min)</label><input type="number" id="studyInput" value="50"></div>
            <div class="field"><label>Break (min)</label><input type="number" id="breakInput" value="10"></div>
            <div class="field"><label>Goal (hrs)</label><input type="number" id="goalInput" value="10"></div>
            <button class="close-btn" onclick="closeSettings()">SAVE & RESET</button>
            <button class="reset-btn" onclick="hardReset()">RESET ALL PROGRESS</button>
        </div>
    </div>

<script>
    let timerId = null, isPaused = true, isStudy = true, isLunch = false;
    let totalStudiedSec = parseInt(localStorage.getItem('studiedSec')) || 0;
    let startTime, baseTimeLeft;

    const circle = document.getElementById('progCircle');
    const circumference = 2 * Math.PI * 140;

    // 1. SMART NOTIFICATIONS
    function requestNotification() {
        if ("Notification" in window && Notification.permission !== "granted") {
            Notification.requestPermission();
        }
    }
    
    function sendNotification(title, body) {
        if ("Notification" in window && Notification.permission === "granted") {
            new Notification(title, { body: body, icon: 'https://cdn-icons-png.flaticon.com/512/2523/2523471.png' });
        }
    }

    // 2. AUDIO CHIME
    function playChime() {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.connect(gain);
        gain.connect(ctx.destination);
        osc.frequency.setValueAtTime(isStudy ? 880 : 523, ctx.currentTime); // High pitch for break, Lower for study
        osc.type = 'sine';
        gain.gain.exponentialRampToValueAtTime(0.00001, ctx.currentTime + 0.5);
        osc.start();
        osc.stop(ctx.currentTime + 0.5);
    }

    function updateDisplay() {
        let effectiveTimeLeft = baseTimeLeft;
        
        // Background-safe calculation
        if (!isPaused && !isLunch) {
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            effectiveTimeLeft = baseTimeLeft - elapsed;
        }

        if (effectiveTimeLeft <= 0) {
            playChime();
            nextSession();
            return;
        }

        const m = Math.floor(Math.abs(effectiveTimeLeft) / 60);
        const s = Math.abs(effectiveTimeLeft) % 60;
        const timeStr = `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        
        // 3. TAB TITLE UPDATE (See time in browser tab)
        document.title = `${timeStr} - ${isStudy ? 'Focus' : 'Break'}`;
        document.getElementById('timer').textContent = timeStr;
        
        const studyMin = parseInt(document.getElementById('studyInput').value);
        const maxSec = (isStudy ? studyMin : parseInt(document.getElementById('breakInput').value)) * 60;
        circle.style.strokeDashoffset = circumference - (effectiveTimeLeft / maxSec) * circumference;

        // Stats update
        let currentContribution = (isStudy && !isPaused && !isLunch) ? Math.floor((Date.now() - startTime) / 1000) : 0;
        const totalWithCurrent = totalStudiedSec + currentContribution;
        const goalTotalSec = parseInt(document.getElementById('goalInput').value) * 3600;
        
        document.getElementById('goal-text').textContent = `Goal: ${Math.min((totalWithCurrent / goalTotalSec) * 100, 100).toFixed(1)}%`;
        const sessionNum = Math.floor(totalWithCurrent / (studyMin * 60)) + 1;
        document.getElementById('sessionDisplay').textContent = `Session ${sessionNum} of ${Math.ceil(goalTotalSec / (studyMin * 60))}`;
    }

    function toggleTimer() {
        requestNotification(); // Ask for permission on first click
        if (isPaused) {
            isPaused = false;
            startTime = Date.now();
            document.getElementById('startBtn').textContent = "PAUSE";
            document.getElementById('status').textContent = isStudy ? "STUDYING" : "BREAK";
            circle.style.stroke = isStudy ? "var(--prim)" : "var(--tert)";
            timerId = setInterval(updateDisplay, 1000);
        } else {
            isPaused = true;
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            if (isStudy) { totalStudiedSec += elapsed; localStorage.setItem('studiedSec', totalStudiedSec); }
            baseTimeLeft -= elapsed;
            clearInterval(timerId);
            document.getElementById('startBtn').textContent = "RESUME";
            document.title = "Paused | Zen Focus";
        }
    }

    function nextSession() {
        const elapsed = isPaused ? 0 : Math.floor((Date.now() - startTime) / 1000);
        if (isStudy) { 
            totalStudiedSec += elapsed; 
            localStorage.setItem('studiedSec', totalStudiedSec);
            sendNotification("Great Job!", "Session finished. Take a break.");
        } else {
            sendNotification("Break Over", "Time to get back to work!");
        }
        
        isStudy = !isStudy;
        baseTimeLeft = (isStudy ? document.getElementById('studyInput').value : document.getElementById('breakInput').value) * 60;
        startTime = Date.now();
        updateDisplay();
    }

    function prevSession() {
        baseTimeLeft = (isStudy ? document.getElementById('studyInput').value : document.getElementById('breakInput').value) * 60;
        startTime = Date.now();
        updateDisplay();
    }

    function toggleLunch() {
        if (!isLunch) {
            const elapsed = isPaused ? 0 : Math.floor((Date.now() - startTime) / 1000);
            if (isStudy) { totalStudiedSec += elapsed; localStorage.setItem('studiedSec', totalStudiedSec); }
            baseTimeLeft -= elapsed;
            isLunch = true;
            document.getElementById('lunchBtn').textContent = "BACK TO WORK";
            document.getElementById('status').textContent = "LUNCH MODE";
            document.title = "On Lunch | Zen Focus";
        } else {
            isLunch = false;
            startTime = Date.now();
            document.getElementById('lunchBtn').textContent = "TIFFIN / LUNCH";
            document.getElementById('status').textContent = isStudy ? "STUDYING" : "BREAK";
        }
    }

    function openSettings() { document.getElementById('settingsOverlay').style.display = 'flex'; }
    function closeSettings() {
        document.getElementById('settingsOverlay').style.display = 'none';
        isPaused = true; clearInterval(timerId);
        document.getElementById('startBtn').textContent = "START";
        isStudy = true;
        baseTimeLeft = document.getElementById('studyInput').value * 60;
        updateDisplay();
    }
    
    function hardReset() {
        if(confirm("Erase all progress?")) {
            totalStudiedSec = 0; localStorage.setItem('studiedSec', 0);
            closeSettings();
        }
    }

    // 4. ACCIDENTAL CLOSE PROTECTION
    window.onbeforeunload = function() {
        if (!isPaused && !isLunch) {
            return "Timer is running. Are you sure?";
        }
    };

    window.onkeydown = (e) => { if(e.code === 'Space') { e.preventDefault(); toggleTimer(); } };

    // Initial Load
    document.getElementById('studyInput').value = localStorage.getItem('studyMin') || 50;
    document.getElementById('breakInput').value = localStorage.getItem('breakMin') || 10;
    document.getElementById('goalInput').value = localStorage.getItem('goalHrs') || 10;
    baseTimeLeft = document.getElementById('studyInput').value * 60;
    updateDisplay();
</script>
</body>
</html>nifest.json">
    <style>
        :root {
            --bg: #0f0f12; --surf: #1d1b20; --prim: #d0bcfe;
            --on-prim: #381e72; --sec: #4a4458; --tert: #efb8c8;
        }
        body {
            background-color: var(--bg); color: #e6e1e5;
            font-family: 'Segoe UI', system-ui, sans-serif;
            margin: 0; display: flex; flex-direction: column;
            align-items: center; justify-content: center; min-height: 100vh;
            overflow: hidden;
        }
        .timer-wrapper {
            position: relative; width: 340px; height: 340px;
            display: flex; align-items: center; justify-content: center;
        }
        svg { transform: rotate(-90deg); position: absolute; }
        circle { fill: none; stroke-width: 8; stroke-linecap: round; }
        .bg-circle { stroke: #25232a; }
        .progress-circle {
            stroke: var(--prim); stroke-dasharray: 880;
            stroke-dashoffset: 0; transition: stroke-dashoffset 0.5s linear;
        }
        .timer-content { text-align: center; z-index: 1; }
        .timer-text { font-size: 6.5rem; font-weight: 200; margin: 0; tabular-nums; }
        .status-badge { font-size: 0.8rem; letter-spacing: 2px; color: var(--prim); font-weight: 600; margin-bottom: 2px;}
        .session-counter { font-size: 0.85rem; color: var(--prim); opacity: 0.8; margin-bottom: 5px; }
        .goal-inside { font-size: 0.9rem; color: #938f99; margin-top: 5px; }

        .controls { display: flex; gap: 12px; margin-top: 30px; align-items: center; }
        button { border: none; cursor: pointer; border-radius: 100px; transition: 0.2s; font-weight: bold;}
        .btn-play { background: var(--prim); color: var(--on-prim); padding: 18px 55px; font-size: 1.1rem; }
        .btn-nav { background: var(--sec); color: white; width: 55px; height: 55px; font-size: 1.2rem; }
        .btn-lunch { background: var(--tert); color: #492532; padding: 18px 25px; margin-top: 15px; }
        
        #settingsOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); display: none;
            justify-content: center; align-items: center; z-index: 100;
            backdrop-filter: blur(10px);
        }
        .settings-card { background: var(--surf); padding: 30px; border-radius: 28px; width: 320px; }
        .field { margin-bottom: 20px; text-align: left; }
        label { display: block; font-size: 0.8rem; color: #938f99; margin-bottom: 5px; }
        input { width: 100%; background: #2b2930; border: 1px solid #444; color: white; padding: 12px; border-radius: 10px; box-sizing: border-box; }
        .close-btn { background: var(--prim); color: var(--on-prim); width: 100%; padding: 15px; margin-top: 10px; }
    </style>
</head>
<body>

    <div class="timer-wrapper">
        <svg width="300" height="300"><circle class="bg-circle" cx="150" cy="150" r="140"></circle><circle id="progCircle" class="progress-circle" cx="150" cy="150" r="140"></circle></svg>
        <div class="timer-content">
            <div id="sessionDisplay" class="session-counter">Session 1 of 12</div>
            <div id="status" class="status-badge">READY</div>
            <h1 class="timer-text" id="timer">00:00</h1>
            <div class="goal-inside" id="goal-text">Goal: 0%</div>
        </div>
    </div>

    <div class="controls">
        <button class="btn-nav" onclick="openSettings()">⚙️</button>
        <button class="btn-nav" onclick="prevSession()">⏮</button>
        <button class="btn-play" id="startBtn" onclick="toggleTimer()">START</button>
        <button class="btn-nav" onclick="nextSession()">⏭</button>
    </div>
    
    <button class="btn-lunch" id="lunchBtn" onclick="toggleLunch()">TIFFIN / LUNCH</button>

    <div id="settingsOverlay">
        <div class="settings-card">
            <h2 style="margin-top:0">Settings</h2>
            <div class="field"><label>Study (min)</label><input type="number" id="studyInput" value="50"></div>
            <div class="field"><label>Break (min)</label><input type="number" id="breakInput" value="10"></div>
            <div class="field"><label>Goal (hrs)</label><input type="number" id="goalInput" value="10"></div>
            <button class="close-btn" onclick="closeSettings()">SAVE & RESET</button>
        </div>
    </div>

<script>
    let timerId = null, isPaused = true, isStudy = true, isLunch = false;
    let totalStudiedSec = parseInt(localStorage.getItem('studiedSec')) || 0;
    let startTime, baseTimeLeft;

    const circle = document.getElementById('progCircle');
    const circumference = 2 * Math.PI * 140;

    // Synthesized chime sound instead of voice
    function playChime() {
        const context = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = context.createOscillator();
        const gainNode = context.createGain();

        oscillator.type = 'sine';
        oscillator.frequency.setValueAtTime(880, context.currentTime); // High pitch A5
        oscillator.frequency.exponentialRampToValueAtTime(440, context.currentTime + 0.5);

        gainNode.gain.setValueAtTime(0.1, context.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, context.currentTime + 0.5);

        oscillator.connect(gainNode);
        gainNode.connect(context.destination);

        oscillator.start();
        oscillator.stop(context.currentTime + 0.5);
    }

    function updateDisplay() {
        let effectiveTimeLeft = baseTimeLeft;
        if (!isPaused && !isLunch) {
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            effectiveTimeLeft = baseTimeLeft - elapsed;
        }

        if (effectiveTimeLeft <= 0) {
            playChime();
            nextSession();
            return;
        }

        const m = Math.floor(Math.abs(effectiveTimeLeft) / 60);
        const s = Math.abs(effectiveTimeLeft) % 60;
        document.getElementById('timer').textContent = `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        
        const studyMin = parseInt(document.getElementById('studyInput').value);
        const maxSec = (isStudy ? studyMin : parseInt(document.getElementById('breakInput').value)) * 60;
        circle.style.strokeDashoffset = circumference - (effectiveTimeLeft / maxSec) * circumference;

        let currentContribution = (isStudy && !isPaused && !isLunch) ? Math.floor((Date.now() - startTime) / 1000) : 0;
        const totalWithCurrent = totalStudiedSec + currentContribution;

        const goalTotalSec = parseInt(document.getElementById('goalInput').value) * 3600;
        document.getElementById('goal-text').textContent = `Goal: ${Math.min((totalWithCurrent / goalTotalSec) * 100, 100).toFixed(1)}%`;
        document.getElementById('sessionDisplay').textContent = `Session ${Math.floor(totalWithCurrent / (studyMin * 60)) + 1} of ${Math.ceil(goalTotalSec / (studyMin * 60))}`;
    }

    function toggleTimer() {
        if (isPaused) {
            isPaused = false;
            startTime = Date.now();
            document.getElementById('startBtn').textContent = "PAUSE";
            document.getElementById('status').textContent = isStudy ? "STUDYING" : "BREAK";
            circle.style.stroke = isStudy ? "var(--prim)" : "var(--tert)";
            timerId = setInterval(updateDisplay, 1000);
        } else {
            isPaused = true;
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            if (isStudy) { totalStudiedSec += elapsed; localStorage.setItem('studiedSec', totalStudiedSec); }
            baseTimeLeft -= elapsed;
            clearInterval(timerId);
            document.getElementById('startBtn').textContent = "RESUME";
        }
    }

    function nextSession() {
        const elapsed = isPaused ? 0 : Math.floor((Date.now() - startTime) / 1000);
        if (isStudy) { totalStudiedSec += elapsed; localStorage.setItem('studiedSec', totalStudiedSec); }
        isStudy = !isStudy;
        baseTimeLeft = (isStudy ? document.getElementById('studyInput').value : document.getElementById('breakInput').value) * 60;
        startTime = Date.now();
        updateDisplay();
    }

    function prevSession() {
        baseTimeLeft = (isStudy ? document.getElementById('studyInput').value : document.getElementById('breakInput').value) * 60;
        startTime = Date.now();
        updateDisplay();
    }

    function toggleLunch() {
        if (!isLunch) {
            const elapsed = isPaused ? 0 : Math.floor((Date.now() - startTime) / 1000);
            if (isStudy) { totalStudiedSec += elapsed; localStorage.setItem('studiedSec', totalStudiedSec); }
            baseTimeLeft -= elapsed;
            isLunch = true;
            document.getElementById('lunchBtn').textContent = "BACK TO WORK";
            document.getElementById('status').textContent = "LUNCH MODE";
        } else {
            isLunch = false;
            startTime = Date.now();
            document.getElementById('lunchBtn').textContent = "TIFFIN / LUNCH";
            document.getElementById('status').textContent = isStudy ? "STUDYING" : "BREAK";
        }
    }

    function openSettings() { document.getElementById('settingsOverlay').style.display = 'flex'; }
    function closeSettings() {
        document.getElementById('settingsOverlay').style.display = 'none';
        isPaused = true; clearInterval(timerId);
        document.getElementById('startBtn').textContent = "START";
        isStudy = true;
        baseTimeLeft = document.getElementById('studyInput').value * 60;
        updateDisplay();
    }

    window.onkeydown = (e) => { if(e.code === 'Space') { e.preventDefault(); toggleTimer(); } };

    document.getElementById('studyInput').value = localStorage.getItem('studyMin') || 50;
    document.getElementById('breakInput').value = localStorage.getItem('breakMin') || 10;
    document.getElementById('goalInput').value = localStorage.getItem('goalHrs') || 10;
    baseTimeLeft = document.getElementById('studyInput').value * 60;
    updateDisplay();
</script>
</body>
</html>
